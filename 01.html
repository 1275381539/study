<!-- 函数防抖和节流
  防抖概念：在任务频繁触发的情况下,一个事件在被触发的一段时间后再执行回调,假如在这段时间内又被触发了,则重新开始计时.
  节流概念：高频事件触发,但是在n秒内只会执行一次,会稀释函数的执行频率

  实现原理
  函数防抖:原理是维护一个计时器,在规定时间后执行回调.若在此期间再次触发,则重新开始计时
  函数节流:原理是判断是否达到规定时间

  总结：防抖和节流都是为了限制函数的执行频率,以优化函数触发频率过高导致的响应速度跟不上,延迟假死或卡顿的现象

-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #div1 {
      height: 300px;
      background-color: orange;
      overflow: auto;
    }
  </style>
</head>
<body>
  <!-- 防抖 -->
  <!--    简易版
  <input id="ipt1" />
  <script>
    let ipt1 = document.querySelector('#ipt1')
    let timer = null
    ipt1.onkeydown = function(e){
        clearTimeout(timer)
        timer = setTimeout(() => {
            console.log(e.target.value)
        },500)
    }
  </script> -->
  <!-- 函数版 -->
  <!-- <div id="div1"></div>
  <script>
    let div1 = document.querySelector('#div1')
    function move(e){
      this.innerText = `${e.offsetX},${e.offsetY}`
    }
    function debounce(fn, wait){
      let timer = null
      return function(){
        let args = arguments
        clearTimeout(timer)
        timer = setTimeout(() => {
          fn.apply(this, args)
        }, wait)
      }
    }
    let debounceMove = debounce(move, 500)
    div1.onmousemove = debounceMove
  </script> -->
  <!-- 节流 -->
  <div id="div1">
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <p>1</p>
  </div>
  <script>
    // 不加节流
    // let div1 = document.querySelector('#div1')
    // div1.onscroll = function(e){
    //     console.log('我在疯狂输出')
    // }

    // 加了节流的
    // let div1 = document.querySelector('#div1')
    // let flag = true
    // div1.onscroll = function(e){
    //     if(!flag){
    //         return false
    //     }
    //     flag = false
    //     setTimeout(() => {
    //         console.log('我在慢慢输出')
    //         flag = true
    //     },500)
    // }

    // 函数版
    // 定时器版本 
    // let div1 = document.querySelector('#div1')
    // function move(e){
    //   this.innerText = `(${e.offsetX}, ${e.offsetY})`
    // }
    // function throttle(fn, wait){
    //   let timer = null
    //   return function(){
    //     let args = arguments
    //     if(!timer){
    //       timer = setTimeout(() => {
    //         timer = null
    //         fn.apply(this, args)
    //       }, wait)
    //     }
    //   }
    // }
    // let throttleMove = throttle(move, 500)
    // div1.onmousemove = throttleMove 

    // 时间戳版本
    // let div1 = document.querySelector('#div1')
    // function move(e){
    //   this.innerText = `(${e.offsetX}, ${e.offsetY})`
    // }
    // function throttle(fn, wait){
    //   let time = 0
    //   return function(){
    //     let now = Date.now()
    //     let args = arguments
    //     if(now - time > wait){
    //       fn.apply(this, args)
    //       time = now
    //     }
    //   }
    // }
    // let throttleMove = throttle(move, 500)
    // div1.onmousemove = throttleMove 

    // 定时器+时间戳版本
    let div1 = document.querySelector('#div1')
    function move(e){
      this.innerText = `(${e.offsetX}, ${e.offsetY})`
    }
    function throttle(fn, wait){
      let time = 0, timer = null
      return function(){
        let now = Date.now()
        let args = arguments
        if(now - time > wait){
          fn.apply(this, args)
          time = now
        }else{
          timer && clearTimeout(timer)
          timer = setTimeout(() => {
            fn.apply(this, args)
            time = now
          }, wait)
        }
      }
    }
    let throttleMove = throttle(move, 500)
    div1.onmousemove = throttleMove 
  </script>
</body>
</html>